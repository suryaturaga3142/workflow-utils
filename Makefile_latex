# REMEMBER TO RENAME FILE TO MAKE IT WORK
# Makefile for compiling LaTeX projects in subdirectories

LATEXMK = latexmk
# Disabled xelatex
LATEXMK_OPTS =-interaction=nonstopmode -file-line-error
TEXDIRS := $(sort $(dir $(wildcard */*.tex)))
PROJECTS := $(basename $(notdir $(wildcard */*.tex)))

all: $(PROJECTS)

$(PROJECTS):
	@echo "Building $@..."
	@mkdir -p $@/build
	$(LATEXMK) $(LATEXMK_OPTS) -outdir=$@/build $@/$@.tex
	@cp $@/build/$@.pdf $@/
	@echo "Done."

%:
	@echo "Building $@..."
	@mkdir -p $@/build
	$(LATEXMK) $(LATEXMK_OPTS) -outdir=$@/build $@/$@.tex
	@cp $@/build/$@.pdf $@/
	@echo "Done."

watch-%:
	@mkdir -p $*/build
	$(LATEXMK) $(LATEXMK_OPTS) -outdir=$*/build -pvc $*/$*.tex

clean-%:
	@echo "Cleaning $*..."
	@rm -rf $*/build $*/$*.pdf
	@echo "Done."

clean:
	@for d in $(PROJECTS); do rm -rf $$d/build $$d/$$d.pdf; done
	@echo "Done."

.PHONY: all clean $(PROJECTS) watch-% clean-%
