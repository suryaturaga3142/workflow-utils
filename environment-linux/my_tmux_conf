# ~/.tmux.conf

# --- Prefix & General Settings ---
unbind C-b
set -g prefix C-a
bind C-a send-prefix

set -g mouse on

# Fix colors for Gruvbox/Vim
set -g default-terminal "screen-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Start window/pane numbering at 1
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# --- Navigation (Seamless Vim+Tmux) ---
# Uses Ctrl + h/j/k/l (No Prefix)
# Requires 'christoomey/vim-tmux-navigator' plugin in Vim

is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# Restore Clear Screen (Prefix + C-l)
bind C-l send-keys 'C-l'

# --- Resizing Panes (Prefix + Arrows) ---
# Note: Use -r so to hold the key (Prefix -> Left... Left... Left)
bind -r Left resize-pane -L 5
bind -r Down resize-pane -D 5
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5

# --- Moving Panes (Prefix + H/J/K/L) ---
#bind H swap-pane -L
#bind J swap-pane -D
#bind K swap-pane -U
#bind L swap-pane -R
bind H select-pane -L \; swap-pane -s '!'
bind J select-pane -D \; swap-pane -s '!'
bind K select-pane -U \; swap-pane -s '!'
bind L select-pane -R \; swap-pane -s '!'

# --- Split Management ---
# Use | for vertical split (side-by-side) and - for horizontal (stacked)
# (Keeps current path when splitting)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# --- Window (Tab) Management ---
# Create new window
bind c new-window -c "#{pane_current_path}"

# Move to Next/Prev Window (Prefix + l / Prefix + h)
# Matches Vim logic (Space + l / Space + h)
bind l next-window
bind h previous-window

# Swap window position (Prefix + < or >)
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# --- Plugins ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'wfxr/tmux-power'
set -g @plugin 'wfxr/tmux-net-speed'

# --- Power Config ---
#set -g status on
#set -g status-interval 3
set -g status-justify left
set -g status-position bottom
#set -g update-environment "PWD"

set -g @tmux_power_theme 'everforest'

set -g @tmux_power_date_icon           ' '
set -g @tmux_power_time_icon           ' '
set -g @tmux_power_user_icon           ' '
set -g @tmux_power_session_icon        ' '
set -g @tmux_power_right_arrow_icon    ''
set -g @tmux_power_left_arrow_icon     ''
set -g @tmux_power_upload_speed_icon   ' '
set -g @tmux_power_download_speed_icon ' '

set -g @tmux_power_show_user    false
set -g @tmux_power_show_host    true
set -g @tmux_power_show_session true

set -g @tmux_power_date_format '%d-%m-%Y'
set -g @tmux_power_show_upload_speed   true
set -g @tmux_power_show_download_speed true

# Auto-install tpm if not found
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

run '~/.tmux/plugins/tpm/tpm'

